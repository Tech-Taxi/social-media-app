<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Testing</title>
  </head>
  <body>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
      integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      window.onload = () => {
        let header = {};

        const login = () => {
          console.log("LOGIN");
          axios
            .post("http://localhost:5000/api/v1/users/login", {
              email: "arnabbanik9@gmail.com",
              password: "password1234",
            })
            .then((res) => {
              alert("logged in");
              console.log(res.data);
              header.Authorization = `Bearer ${res.data.token}`;
              console.log(header);
            })
            .catch((err) => alert(err.message));
        };

        const checkLogin = () => {
          // axios
          //   .post(
          //     "http://localhost:5000/api/v1/users/isLoggedIn",
          //     {},
          //     {
          //       headers:header,
          //       withCredentials: true,
          //     }
          //   )
          //   .then((response) => {
          //     // Handle the response data
          //     console.log(response.data);
          //   })
          //   .catch((error) => {
          //     // Handle any errors
          //     console.error(error);
          //   });
          fetch("http://localhost:5000/api/v1/users/isLoggedIn", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": JSON.stringify(header),
            },
            body: JSON.stringify({}),
            credentials: "include",
          })
            .then((response) => {
              // Handle the response
              return response.json();
            }).then(res=> res)
            .catch((error) => {
              // Handle the error
              console.log(error);
            });
        };
        document.getElementById("login").addEventListener("click", login);
        document
          .getElementById("checklogin")
          .addEventListener("click", checkLogin);
      };

      const update = () => {
        axios
          .patch(
            "http://localhost:5000/api/v1/users/udpateMe",
            {
              bio: "This is a test bio",
            },
            { withCredential: true }
          )
          .then((res) => {
            console.log(res.data);
          })
          .catch((err) => {
            console.log(err);
          });
      };
    </script>

    <button id="login">Login</button>
    <button id="checklogin">Check Login</button>
  </body>
</html>
